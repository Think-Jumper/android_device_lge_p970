on boot-pause
    exec sbin/chargerlogo

on init
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "performance"
    export DSP_PATH /system/lib/dsp
    export DEFAULT_BASEIMAGE /system/lib/dsp/baseimage.dof
    export QOSDYN_FILE /system/lib/dsp/qosdyn_3430.dll64P
    export EXTERNAL_STORAGE /mnt/sdcard

# Backward compatibility
    symlink /system/bin /bin
    symlink /system/lib /lib

# create mountpoints
    mkdir /mnt 0775 root system
    mkdir /mnt/sdcard 0000 system system

# Backwards Compat - XXX: Going away in G*
    symlink /mnt/sdcard /sdcard

# LGE
    mkdir /sqlite_stmt_journals 01777 root root
    mount tmpfs tmpfs /sqlite_stmt_journals size=4m

    mkdir /dvp 0771 system system
    mkdir /dvp/hwkey 0771 system system
    mkdir /dvp/userdata 0771 system system

    chown system system /sys/class/leds/lcd-backlight/als

    # Increase readahead buffers on MMC devices
    write /sys/block/mmcblk0/bdi/read_ahead_kb 1024
    write /sys/block/mmcblk1/bdi/read_ahead_kb 1024

on fs
# mount mtd partitions
    # Mount /system rw first to give the filesystem a chance to save a checkpoint
    mount ext4 /dev/block/mmcblk0p8 /system ro noatime barrier=1 wait
    # We chown/chmod /data again so because mount is run as root + defaults
    mount ext4 /dev/block/mmcblk0p9 /data nosuid nodev noatime barrier=1 wait
    chown system system /data
    chmod 0771 /data

    mount ext3 /dev/block/mmcblk0p6 /dvp/hwkey nosuid nodev
    chown system system /dvp/hwkey
    chown system divxdrm /dvp/hwkey/key.hw
    chmod 0660 /dvp/hwkey/key.hw
    mount ext3 /dev/block/mmcblk0p6 /dvp/userdata nosuid nodev
    chown system divxdrm /dvp/userdata
    chmod 0770 /dvp/userdata
    chown system system /dev/block/mmcblk0p5
    chown system system /dev/block/mmcblk0p12
    chmod 0777 /dev/block/mmcblk0p5
    chmod 0777 /dev/block/mmcblk0p12

    mount ext4 /dev/block/mmcblk0p10 /cache nosuid nodev noatime barrier=1 wait

    mkdir /lgdrm 0770 lgdrm lgdrm_acc
    mount ext3 /dev/block/mmcblk0p5 /lgdrm nosuid nodev

    # Mount compressed filesystems
    mount squashfs loop@/system/lib/modules/modules.sqf /system/lib/modules ro
    mount squashfs loop@/system/xbin/xbin.sqf /system/xbin ro

    chmod 0777 /data/misc/wifi/config_mac
    mkdir /data/misc/wifi/sockets 0770 wifi wifi
    mkdir /data/misc/dhcp 0777 dhcp dhcp
    setprop wifi.supplicant_scan_interval 20
    setprop wifi.interface wlan0

on boot
    chmod 0660 /sys/class/rfkill/rfkill0/state
    chmod 0660 /sys/class/rfkill/rfkill0/type
    chmod 0660 /sys/class/rfkill/rfkill1/state
    chmod 0660 /sys/class/rfkill/rfkill1/type
    chmod 0666 /sys/devices/platform/bd_address/bdaddr_if
    chown bluetooth bluetooth /sys/class/rfkill/rfkill0/state
    chown bluetooth bluetooth /sys/class/rfkill/rfkill0/type
    chown bluetooth bluetooth /sys/class/rfkill/rfkill1/state
    chown bluetooth bluetooth /sys/class/rfkill/rfkill1/type
    write /sys/class/rfkill/rfkill0/state 0

    chown system system /sys/devices/platform/motion_sensor/accel_onoff
    chown system system /sys/devices/platform/motion_sensor/accel_delay
    chown system system /sys/devices/platform/motion_sensor/compass_onoff
    chown system system /sys/devices/platform/motion_sensor/compass_delay
    chown system system /sys/devices/platform/motion_sensor/tilt_onoff
    chown system system /sys/devices/platform/motion_sensor/tilt_delay
    chown system system /sys/devices/platform/motion_sensor/gyro_onoff
    chown system system /sys/devices/platform/motion_sensor/gyro_delay
    chown system system /sys/bus/i2c/drivers/hub_proxi/3-0044/onoff
    chown system system /sys/bus/i2c/drivers/hub_proxi/3-0044/delay
    chown system system /sys/devices/platform/motion_sensor/shake_onoff
    chown system system /sys/bus/i2c/drivers/kxtf9/3-000f/shake_onoff
    chown system system /sys/devices/platform/motion_sensor/snap_onoff
    chown system system /sys/bus/i2c/drivers/kxtf9/3-000f/snap_onoff
    chown system system /sys/devices/platform/motion_sensor/flip_onoff
    chown system system /sys/bus/i2c/drivers/kxtf9/3-000f/flip_onoff
    chown system system /sys/devices/platform/motion_sensor/tap_onoff
    chown system system /sys/bus/i2c/drivers/kxtf9/3-000f/tap_onoff
    chown system system /sys/devices/platform/motion_sensor/yawimage_onoff
    chown system system /sys/devices/platform/i2c-gpio.7/i2c-adapter/i2c-7/7-001c/checkresult
    chown system system /sys/devices/platform/i2c-gpio.7/i2c-adapter/i2c-7/7-001c/checkopmode
    chmod 0666 /sys/devices/platform/motion_sensor/accel_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/accel_delay
    chmod 0666 /sys/devices/platform/motion_sensor/compass_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/compass_delay
    chmod 0666 /sys/devices/platform/motion_sensor/tilt_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/tilt_delay
    chmod 0666 /sys/devices/platform/motion_sensor/gyro_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/gyro_delay
    chmod 0666 /sys/bus/i2c/drivers/hub_proxi/3-0044/onoff
    chmod 0666 /sys/bus/i2c/drivers/hub_proxi/3-0044/delay
    chmod 0666 /sys/devices/platform/motion_sensor/shake_onoff
    chmod 0666 /sys/bus/i2c/drivers/kxtf9/3-000f/shake_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/snap_onoff
    chmod 0666 /sys/bus/i2c/drivers/kxtf9/3-000f/snap_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/flip_onoff
    chmod 0666 /sys/bus/i2c/drivers/kxtf9/3-000f/flip_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/tap_onoff
    chmod 0666 /sys/bus/i2c/drivers/kxtf9/3-000f/tap_onoff
    chmod 0666 /sys/devices/platform/motion_sensor/yawimage_onoff
    chmod 0666 /sys/devices/platform/i2c-gpio.7/i2c-adapter/i2c-7/7-001c/checkresult
    chmod 0666 /sys/devices/platform/i2c-gpio.7/i2c-adapter/i2c-7/7-001c/checkopmode

    chmod 0666 /sys/devices/platform/omapdss/display0/name
    chmod 0666 /sys/devices/platform/omapdss/display1/name
    chmod 0666 /sys/devices/platform/omapdss/display0/enabled
    chmod 0666 /sys/devices/platform/omapdss/display1/enabled
    chmod 0666 /sys/devices/platform/omapdss/display0/timings
    chmod 0666 /sys/devices/platform/omapdss/display1/timings
    chmod 0666 /sys/devices/platform/omapdss/overlay0/manager
    chmod 0666 /sys/devices/platform/omapdss/overlay1/manager
    chmod 0666 /sys/devices/platform/omapdss/overlay2/manager
    chmod 0666 /sys/devices/platform/omapdss/overlay0/zorder
    chmod 0666 /sys/devices/platform/omapdss/overlay1/zorder
    chmod 0666 /sys/devices/platform/omapdss/overlay2/zorder
    chmod 0666 /sys/devices/platform/omapdss/overlay0/enabled
    chmod 0666 /sys/devices/platform/omapdss/overlay1/enabled
    chmod 0666 /sys/devices/platform/omapdss/overlay2/enabled
    chmod 0666 /sys/devices/platform/omapdss/manager0/display
    chmod 0666 /sys/devices/platform/omapdss/manager1/display
    chmod 0666 /sys/devices/platform/omapdss/manager0/trans_key_enabled
    chmod 0666 /sys/devices/platform/omapdss/manager1/trans_key_enabled
    chmod 0666 /sys/devices/platform/omapdss/manager0/trans_key_type
    chmod 0666 /sys/devices/platform/omapdss/manager1/trans_key_type
    chmod 0666 /sys/devices/platform/omapdss/manager0/trans_key_value
    chmod 0666 /sys/devices/platform/omapdss/manager1/trans_key_value
    chmod 0666 /sys/devices/platform/omapdss/manager0/alpha_blending_enabled
    chmod 0666 /sys/devices/platform/omapdss/manager1/alpha_blending_enabled
    write /sys/devices/platform/omapdss/manager0/alpha_blending_enabled 1

# MMS: Create log directory for fw3a_core
    mkdir /data/log/fw3A 0775 root root

# change permissions for alsa nodes
    symlink /dev/snd/pcmC0D0c /dev/pcmC0D0c
    symlink /dev/snd/pcmC0D0p /dev/pcmC0D0p
    symlink /dev/snd/controlC0 /dev/controlC0
    symlink /dev/snd/timer /dev/timer
    chmod 0777 /dev/pcmC0D0c
    chmod 0777 /dev/pcmC0D0p
    chmod 0777 /dev/controlC0
    chmod 0777 /dev/timer

# vibrator
    chown shell system /dev/tspdrv
    chmod 0660 /dev/tspdrv

    chmod 0664 /sys/devices/platform/i2c_omap.2/i2c-2/2-0060/leds/lcd-backlight/als
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-0060/leds/lcd-backlight/als

    # Batt gauge error detection
    chmod 0666 /sys/bus/platform/drivers/twl4030_bci/twl4030_bci/gauge_if

    # Enabling sleep in idle path
    write /sys/power/sleep_while_idle 1

    # Enabling Off mode
    write /sys/power/enable_off_mode 1

    # Enabling voltage off while idle
    write /sys/power/voltage_off_while_idle 1

    # Permissions for setting the DSP Frequency
    chown media root /sys/power/dsp_freq
    chown media system /sys/devices/platform/omap3isp/isp_reserve

# gps permissions
    chown system system /sys/devices/platform/hub_gps_gpio/poweron
    chown system system /sys/devices/platform/hub_gps_gpio/reset
    mkdir /data/gps
    chmod 777 /data/gps
    mkdir /data/gps/var
    chmod 777 /data/gps/var
    mkdir /data/gps/var/run
    chmod 777 /data/gps/var/run
    mkdir /data/gps/log
    chmod 777 /data/gps/log
    mkdir /data/cache
    chmod 777 /data/cache

    ## Torch perms
    chown system camera /sys/class/leds/rt8515/brightness
    chmod 0660 /sys/class/leds/rt8515/brightness

    ## liblights
    chown system system /sys/class/leds/lcd-backlight/brightness
    chown system system /sys/class/leds/lcd-backlight/onoff
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/led_brightness
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/led_onoff
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/led_sync
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/blink_enable
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x06
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x07
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x0D
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x0E
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x10
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x11
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x03
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x04
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x09
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x0A
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x13
    chown system system /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/0x14

service prb /sbin/prb
    class core
    user root
    disabled
    oneshot
    keycodes 114 116

# Press G-key for recovery
service g-recovery /sbin/g-recovery
    user root
    oneshot

service pvrsrvinit /system/bin/pvrsrvinit
    class core
    user root
    group root
    oneshot

# load DSP firmware
service baseimage /system/bin/cexec.out /system/lib/dsp/baseimage.dof
    class core
    user root
    group system audio camera graphics inet net_bt net_bt_admin net_raw media
    oneshot

service fw3a /system/bin/fw3a_core --dbgport=6660 --dbgremote --dbgpath=/data/log/fw3A
    class core
    user root
    group root

service map /system/bin/sdptool add --channel=16 MAS
    class core
    user bluetooth
    group bluetooth net_bt_admin
    disabled
    oneshot

service immvibed /system/bin/immvibed
    class main
    user shell
    group system
    oneshot

service glgps /system/bin/glgps -c /system/etc/gps_brcm_conf.xml
    class main
    user root
    group system

on property:dev.bootcomplete=1
    write /sys/devices/platform/i2c_omap.2/i2c-2/2-001a/blink_enable 0
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "interactive"
    #write /sys/devices/system/cpu/cpu0/cpufreq/ondemand/up_threshold 90
    #write /sys/devices/system/cpu/cpu0/cpufreq/ondemand/sampling_rate 40000
    write /sys/devices/system/cpu/cpu0/cpufreq/turn_on_lg_dvfs 1

service dhcpcd_wlan0 /system/bin/dhcpcd -BKAL wlan0
    class main
    disabled
    oneshot

service iprenew_wlan0 /system/bin/dhcpcd -n wlan0
    class main
    disabled
    oneshot

on property:init.svc.wpa_supplicant=stopped
    stop dhcpcd_wlan0

service wpa_supplicant /system/bin/wpa_supplicant -Dwext -iwlan0 -c/data/misc/wifi/wpa_supplicant.conf #-dd
    class main
    socket wpa_wlan0 dgram 660 wifi wifi
    group system wifi inet
    disabled
    oneshot

service hciattach /system/bin/brcm_patchram_plus --enable_hci --enable_lpm \
    --baudrate 3000000 --patchram /etc/firmware/BCM43291A0_003.001.013.0066.xxxx_B-Project.hcd /dev/ttyO1
    class main
    user bluetooth
    group bluetooth net_bt_admin
    disabled
    oneshot

service rawip_vsnet1 /system/bin/init.vsnet 1
   class main
   user root
   group radio cache inet misc
   disabled
   oneshot

service rawip_vsnet1 /system/bin/init.vsnet 2
   class main
   user root
   group radio cache inet misc
   disabled
   oneshot

service rawip_vsnet1 /system/bin/init.vsnet 3
   class main
   user root
   group radio cache inet misc
   disabled
   oneshot

service rawip_vsnet1 /system/bin/init.vsnet 4
   class main
   user root
   group radio cache inet misc
   disabled
   oneshot

service wlan_precheck /system/bin/wlan-precheck
    class main
    oneshot
